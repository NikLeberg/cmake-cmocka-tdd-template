# cmake-cmocka-tdd-template

This is a template for **test driven development** [tdd](https://en.wikipedia.org/wiki/Test-driven_development) for a C project. The project gets generated by `cmake` and build by `gcc`. The tests use the integrated `ctest` funcionality of cmake and are written with the [cmocka](https://cmocka.org/) framework. Additionally `doxygen` is used to automaticly generate source code documentation and `cppcheck` to statically analyze the source code.


## Requirements

Version in brackets is what was used at the time of writing. 
- cmake (3.18.4)
- gcc (10.3.0)
- cppcheck (2.3)
- cmocka (1.1.5-2)
- doxygen (1.9.1)

A [Dockerfile](.devcontainer/Dockerfile) is available for easy setup of the needed tools. Or even easier as prebuilt image on dockerhub [nikolodion/cmake-tdd](https://hub.docker.com/r/nikolodion/cmake-tdd). If VSCode or another supported editor is used one could also use the additional [devcontainer.json](.devcontainer/devcontainer.json) to setup the environment automatically.


## Usage

Please note that the commands have to be executed from the `build` subdirectory.

command | action | &nbsp;
---|---|---
`cmake ..` | generate buildsystem | &nbsp;
`make` | compile source code | executable can be found under [build/src/](build/src/)
`make test_cmocka` | run cmocka tests | &nbsp;
`make test_cppcheck` | check source code with cppcheck | &nbsp;
`make tests` | run all tests  | cmocka & cppcheck
`make doc` | generate documentation | to view open [build/doc/html/index.html](build/doc/html/index.html)
`make clean` | remove compiled files | &nbsp;

If VSCode is used these commands are also available as tasks in [tasks.json](.vscode/tasks.json).


## Project structure

- lib/
    - Place for external dependencies.
- src/
    - Here is all the source code for the application placed.
    - For modular code subfolders with appropriate CMake-Scripts can be created. As example see [mylib/CMakeLists.txt](src/mylib/CMakeLists.txt). The module is built as library linked with main.
    - If a file or module is added, add it also to the [CMakeLists.txt](src/CMakeLists.txt).
- test/
    - For each source file in `src` a file that tests the implementation should be created here. The cmocka framework makes this very easy.
    - In the spirit of TDD, the tests should be written at the same time as the code.


## Related Projects

- [cmake-tdd-template](https://github.com/joffman/cmake-tdd-template) - A similar cmake template that is based on Catch2 framework and supports C++.
- [FreeRTOS-Emulator](https://github.com/alxhoff/FreeRTOS-Emulator) - Inspiration for defining the steps like test & check as build targets with cmake.


## License

[MIT](LICENSE) Â© [NikLeberg](https://github.com/NikLeberg).